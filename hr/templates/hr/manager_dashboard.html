<!DOCTYPE html>
<html>
<head>
    <title>Manager Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .section { margin-bottom: 40px; border: 1px solid #ccc; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .btn { padding: 5px 10px; text-decoration: none; color: white; border-radius: 4px; margin-right: 5px; }
        .btn-green { background-color: #28a745; }
        .btn-red { background-color: #dc3545; }
        .btn-blue { background-color: #007bff; }
        .alert { padding: 10px; background-color: #d4edda; color: #155724; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Manager Dashboard</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <a href="{% url 'hire_employee' %}" class="btn btn-blue" style="font-size: 16px;">+ Hire New Employee</a>
    <br><br>

    <div class="section">
        <h2>‚ö†Ô∏è Active Complaints (Reputation System)</h2>
        <table>
            <tr>
                <th>Filer</th>
                <th>Target</th>
                <th>Message</th>
                <th>Weight (VIP)</th>
                <th>Actions</th>
            </tr>
            {% for feedback in pending_feedback %}
            <tr>
                <td>{{ feedback.filer_customer_id }} ({{ feedback.filer_driver_id }})</td>
                <td>
                    {% if feedback.target_customer_id %} Customer: {{ feedback.target_customer_id }} {% endif %}
                    {% if feedback.target_driver_id %} Driver: {{ feedback.target_driver_id }} {% endif %}
                    {% if feedback.target_chef_id %} Chef: {{ feedback.target_chef_id }} {% endif %}
                </td>
                <td>{{ feedback.message }}</td>
                <td>{{ feedback.weight }}</td>
                <td>
                    <form action="{% url 'resolve_feedback' feedback.pk %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="outcome" value="Accepted">
                        <button type="submit" class="btn btn-green">Accept (Warn Target)</button>
                    </form>
                    
                    <form action="{% url 'resolve_feedback' feedback.pk %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="outcome" value="Dismissed">
                        <button type="submit" class="btn btn-red">Dismiss (Warn Filer)</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No pending complaints.</td></tr>
            {% endfor %}
        </table>
    </div>

    <div class="section">
        <h2>üë®‚Äçüç≥ Employee Management</h2>
        <table>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Salary</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            {% for chef in chefs %}
            <tr>
                <td>{{ chef.user.username }}</td>
                <td>Chef</td>
                <td>${{ chef.salary }}</td>
                <td>{{ chef.status }}</td>
                <td>
                    <form action="{% url 'update_salary' chef.pk 'chef' %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <input type="number" name="salary" value="{{ chef.salary }}" style="width: 70px;">
                        <button type="submit" class="btn btn-blue">Update Pay</button>
                    </form>
                    <a href="{% url 'promote_demote' chef.pk 'chef' 'demote' %}" class="btn btn-red">Demote</a>
                    <a href="{% url 'fire_employee' chef.pk 'chef' %}" class="btn btn-red">Fire</a>
                </td>
            </tr>
            {% endfor %}
            
            {% for driver in drivers %}
            <tr>
                <td>{{ driver.user.username }}</td>
                <td>Driver</td>
                <td>${{ driver.salary }}</td>
                <td>{{ driver.status }}</td>
                <td>
                    <form action="{% url 'update_salary' driver.pk 'driver' %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <input type="number" name="salary" value="{{ driver.salary }}" style="width: 70px;">
                        <button type="submit" class="btn btn-blue">Update Pay</button>
                    </form>
                    <a href="{% url 'promote_demote' driver.pk 'driver' 'demote' %}" class="btn btn-red">Demote</a>
                    <a href="{% url 'fire_employee' driver.pk 'driver' %}" class="btn btn-red">Fire</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>